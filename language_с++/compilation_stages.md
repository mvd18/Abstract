# Этапы компиляции программы на С++

**Компиляция** - это процесс преобразования исходного кода (написанного на каком-либо    
языке программирования) в исполняемый машинный код, который может выполнять процессор.

Этот процесс состоит из 4 основных этапов:  
1.Препроцессинг (Preprocessing)  
2.Компиляция (Compilation)  
3.Ассемблирование (Assembly)  
4.Компоновка / Линковка (Linking)  

## Препроцессинг (Preprocessing)

Препроцессор обрабатывает **директивы препроцессора** - строки, начинающиеся с \#  

Основные директивы: \#include - вставляет содержимое другого файла; \#define - определяет макросы;  
\#ifdef, \#ifndef, \#endif - условная компиляция.

```С++
    #include <iostream>
    #define PI 3.14
```

препроцессор заменит \#include <iostream> на содержимое файла iostream, а PI - на 3,14.  

Результат препроцессинга находится в main. i (исходный код препроцессинга)  
`
g++ -E main.cpp -o main.i
`

## Компиляция (Compilation)

Преобразует предварительно обработанный код на С++ в ассемблерный код, специфичный для архитектуры процессора.

На этом этапе происходит проверка синтаксиса, проводится семантический анализ, если есть генерируются ошибки и  
предупреждения, создаётся промежуточный ассемблерный файл (.s)

Результаты компиляции находятся в main.s (ассемблерный код, понятный человеку, но уже близкий к машинному)
`
g++ -S main.i -o main.s
`

## Ассемблирование (Assembly)

Ассемблер (as) преобразует ассемблерный код (.s) в машинный код — объектный файл (.o или .obj).

Объектный файл содержит: машинные инструкции, информацию о символах (именах функций, переменных),  
ссылки на внешние функции (например, printf, cout).

> Но он ещё не исполняемый — потому что не знает, где находятся внешние функции (например, из стандартной библиотеки).

`
g++ -c main.s -o main.o
`

## Компоновка / Линковка (Linking)

Компоновщик (linker) объединяет один или несколько объектных файлов (.o) и библиотек (например, libstdc++.a, libc.a) в один  
исполняемый файл.

На этом этапе: разрешаются внешние ссылки (например, куда ведёт вызов cout << ...), все части программы объединяются,  
генерируется финальный исполняемый файл (.exe).

Если один файл cpp:  
`
g++ main.o -o program
`  
если несколько:  
`
g++ file1.cpp file2.cpp -o program
`  
Компилятор сам пройдёт все этапы для каждого файла и слинкует их.


Исходный код (.cpp)  
        ↓  
   [Препроцессор] → main.i  
        ↓  
   [Компилятор] → main.s  
        ↓  
    [Ассемблер]   → main.o  
        ↓  
   [Компоновщик]  → program.exe  

    | Флаг | Действие |
    |------|:---------|
    | -E   | Только препроцессинг →.i|      
    | -S   | Только компиляция →.s (ассемблер)| 
    | -c   | Только ассемблирование →.o (объектный файл)| 
    |-o имя| Задать имя выходного файла|
    | -v   | Показать подробный вывод (все этапы и вызываемые программы)|
    
